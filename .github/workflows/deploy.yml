name: Deploy-To-EC2-2
'on':
  push:
    branches:
      - master
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '22.4.1'
      - name: Install dependencies
        run: npm install
      - name: Build project
        run: npm run build
      - name: Copy files via SSH
        uses: appleboy/scp-action@v0.1.0
        with:
          host: '${{ secrets.EC2_INSTANCE_APPTEST_IP }}'
          username: ubuntu
          key: '${{ secrets.EC2_SSH_PRIVATE_KEY }}'
          source: build/*
          target: /var/www/myapp/
      - name: Restart Nginx
        run: >
          ssh -i ${{ secrets.SSH_PRIVATE_KEY }} -o StrictHostKeyChecking=no ${{
          secrets.EC2_USER }}@${{ secrets.EC2_INSTANCE_APPTEST_IP }} "sudo systemctl restart
          nginx"
